{% extends "layout.html" %}
{% block title %}
Membership
{% endblock %}

{% block main %}
<h1>Membership</h1>
<p>Register a student into a CCA</p>

    {% if page_type == 'cca' %}
<!--     Shows page with dropdown box to choose cca -->
    <h2>Choose CCA</h2>
    <form action="{{ form_meta['action'] }}" method="{{ form_meta['method'] }}">
        <label for="cca_name">CCA Name:</label>
        <select name="cca_name" id="cca_name">
            {% for cca in cca_names %}
            <option value="{{ cca['name'] }}">{{ cca['name'] }}</option>
            {% endfor %}
        </select>
        <input type="submit" value="Next"> 
    </form>

    {% elif page_type == 'add' %}
<!-- Shows page with table of students to choose students to add into cca -->
    <h2>Existing Students in {{ cca_name }}</h2>
    <table>
        <tr>
            {% for header in headers %}
            <th>{{ header['label'] }}</th>
            {% endfor %}
        </tr>
        {% for record in in_cca %}
        <tr>
            <td>{{ record['name'] }}</td>
            <td>{{ record['class'] }}</td>
        </tr>
        {% endfor %}
    </table>
    <br>
    <h2>Choose Students to Add into {{ cca_name }}</h2>
    
    <form action="/add_membership?confirm" method="{{ form_meta['method'] }}">
        <table>
            <tr>
                <th>Select</th>
                {% for header in headers %}
                <th>{{ header['label'] }}</th>
                {% endfor %}
            </tr>
            {% for record in out_cca %}
            <tr>
                <td> 
                    <input type="checkbox" id="choose" name="choose" value="{{ record['id'] }}">
                </td>
                <td>{{ record['name'] }}<input type="hidden" name="class" value="{{ record['class'] }}"></td>
                <td>{{ record['class'] }}<input type="hidden" name="name" value="{{ record['name'] }}"></td>
            </tr>
            {% endfor %}
        </table>
        <input
                type="hidden"
                name="cca_name"
                value="{{ cca_name }}"
        >
        <input type="submit" value="Submit">
    </form>
    <p id="fail">{{ message }}</p>

    {% elif page_type == 'data' %}
    <h2>Choose student to edit in {{ cca_name }}</h2>
    <table>
        <tr>
            {% for header in headers %}
            <td>{{ header['label'] }}</td>
            {% endfor %}
        </tr>
        <tr>
            {% for record in in_cca %}
            <td>{{ record['name'] }}</td>
            <td>{{ record['class'] }}</td>
            <td>
                <form action="/edit_membership?edit" method="POST">
                    <input type="button" name="edit" value="Edit">
                </form>
            </td>
            <td>
                <form action="/edit_membership?delete" method="POST">
                    <input type="button" name="delete" value="Delete">
                </form>
            </td>
            {% endfor %}
        </tr>
    </table>

    {% elif page_type == 'edit' %}
    <h2>Edit Details for {{ form_data['name'] }}</h2>
    <table>
        {% for name, value in form_data.items() %}
        <tr>
            <th>{{ name }}</th>
            <td>{{ value }}</td>
        </tr>
        {% endfor %}
        <tr>
            <form action="{{ form_meta['action'] }}" method="{{ form_meta['method'] }}">
            <label for="role">Role:</label>
            <input
            id="role"
            type="text"
            name="role"
            value="MEMBER"
            placeholder="Role of Student"
            autocomplete="off"
            >
        </tr>
    </table>
        <input type="submit" value="Confirm">
        </form>
<!-- does this work can you separate the form like this LOL -->
    <p id="fail">{{ message }}</p>

    {% elif page_type == 'confirm' %}
    <h2>Confirm details</h2>
        <table>
            <tr>
                <th>Student ID</th>
                <th>Student Name</th>
            </tr>
            {% for record in form_data %}
            <tr>
                <td>{{ record['id'] }}</td>
                <td>{{ record['name'] }}</td>
            </tr>
            {% endfor %}
        </table>
        <p>Is this correct?</p>
<!--         you dont know how to use fstrings :<<<<<<< -->
        <form action=f"/{{action}}{{ form_meta['action'] }}?verify" method="{{ form_meta['method'] }}">
            {% for record in form_data %}
            <input
                type="hidden"
                name="name"
                value="{{ record['name'] }}"
                >
            <input
                type="hidden"
                name="id"
                value="{{ record['id'] }}"
                >
            {% endfor %}
            <input type="submit" value="Yes">
            <input
                type="hidden"
                name="cca_name"
                value="{{ cca_name }}"
            >
        </form>
        
        <form action="/add_membership" method="GET">
            <input type="submit" value="No">
        </form>
    {% endif %}
{% endblock %}